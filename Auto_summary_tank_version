# existing data = file database
# new data = data that use for update
# final data = ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏° + ‡∏Å‡∏≤‡∏£ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ‡∏à‡∏≤‡∏Å new data
import pandas as pd
from google.colab import files
from datetime import datetime
import openpyxl # Ensure openpyxl is imported for ExcelWriter engine

# Key Customers
key_customers_list = [
    "101296", "101203", "102213", "101602", "100768", "101527", "100354", "101818", "102204"
]

print("Upload Updated Data file")
uploaded_old = files.upload()
update_filename = next(iter(uploaded_old))
existing_data = pd.read_excel(update_filename)

print("Upload All Project Data file")
uploaded_new = files.upload()
new_filename = next(iter(uploaded_new))
new_data = pd.read_excel(new_filename, sheet_name='All Project Data')

# Clean columns
cols_total = new_data.shape[1]
cols_main = new_data.iloc[:, 0:26]
cols_extra = new_data.iloc[:, 103:110] if cols_total >= 110 else pd.DataFrame()
new_data = pd.concat([cols_main, cols_extra], axis=1)

rename_cols = {
    "Winnner Value": "Winner Value", "WinnnerValue": "Winner Value", "WinnerValue": "Winner Value",
    "Project ID": "ProjectID", "Project Id": "ProjectID", "projectid": "ProjectID",
    "Status Running_Status": "StatusRunning_Status", "Winer Name": "WinnerName", "WinerName": "WinnerName",
    "Winner Name ": "WinnerName", "Winnername": "WinnerName", "Winer Date": "WinnerDate",
    "WinerDate": "WinnerDate", "Winer Value": "Winner Value", "WinerValue": "Winner Value", "Winner Value ": "Winner Value",
    "Winnervalue": "Winner Value"
}

new_data.columns = new_data.columns.astype(str).str.strip()
new_data = new_data.rename(columns=rename_cols)
new_data["Budget"] = new_data["Budget"].astype(str).str.replace(',', '').str.replace(' ', '').astype(float)
new_data["Date"] = pd.to_datetime(new_data["Date"], errors='coerce').dt.strftime('%Y-%m-%d')
new_data_filtered = new_data.copy()

existing_data.columns = existing_data.columns.astype(str).str.strip()
existing_data = existing_data.rename(columns=rename_cols)
if "Budget" in existing_data.columns:
    existing_data["Budget"] = existing_data["Budget"].astype(str).str.replace(',', '').str.replace(' ', '').astype(float)
    existing_data["Date"] = pd.to_datetime(existing_data["Date"], errors='coerce').dt.strftime('%Y-%m-%d')

# Match columns
desired_order = [
    "Date", "ProjectID", "Procurement Method", "Subject", "Location", "Owner", "Province", "Region",
    "Budget", "TOR", "Type", "Bid document Start", "Bid document End", "BiddingDate", "RobotWorking",
    "Sale Owner Name", "WinnerName", "WinnerDate", "Winner Value", "PurchaseDoc", "Contract e-GP",
    "Contract Number", "SignDate", "Contract End Date", "StatusDate", "StatusRunning_Status",
    "SalesPersonCode", "CustomerGroup", "CustomerCode", "CustomerName", "Document Link", "Robot Tracking Status"
]

if existing_data.empty or "ProjectID" not in existing_data.columns:
    desired_order_filtered = [col for col in desired_order if col in new_data_filtered.columns]
    existing_data = pd.DataFrame(columns=desired_order_filtered)

new_data_filtered = new_data_filtered[[col for col in desired_order if col in new_data_filtered.columns]].copy()
existing_data = existing_data[[col for col in desired_order if col in existing_data.columns]].copy()

if "ProjectID" not in new_data_filtered.columns or "ProjectID" not in existing_data.columns:
    raise ValueError("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå 'ProjectID' ‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå")

existing_data = existing_data.set_index("ProjectID")
new_data_filtered = new_data_filtered.set_index("ProjectID")

all_columns = existing_data.columns.union(new_data_filtered.columns)
existing_data = existing_data.reindex(columns=all_columns)
new_data_filtered = new_data_filtered.reindex(columns=all_columns)
existing_data.update(new_data_filtered)

new_only = new_data_filtered.loc[~new_data_filtered.index.isin(existing_data.index)].reset_index().copy()
new_only["CustomerCode_str"] = new_only["CustomerCode"].fillna(0).astype(int).astype(str)

final_data = pd.concat([existing_data, new_only.set_index("ProjectID")]).reset_index().copy()
final_data = final_data[[col for col in desired_order if col in final_data.columns]]
final_data["CustomerCode_str"] = final_data["CustomerCode"].fillna(0).astype(int).astype(str)

today_str = datetime.now().strftime('%Y-%m-%d')
updated_file = f"Updated_Data_{today_str}.xlsx"
final_data.to_excel(updated_file, index=False)
files.download(updated_file)

#--------------------------------------------------Summary-----------------------------------------------------------#

# ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô tracking ‡∏Ç‡∏≠‡∏áall data(‡πÉ‡∏ä‡πâ row[col_name] ‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏±‡∏á reset_index)
def create_tracking(df):
    tracking_rows = []
    # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏°‡∏µ CustomerCode_str
    if "CustomerCode_str" not in df.columns:
         df["CustomerCode_str"] = df["CustomerCode"].fillna(0).astype(int).astype(str)

    # ‡πÉ‡∏ä‡πâ 'CustomerCode_str' ‡πÅ‡∏•‡∏∞ 'CustomerName' ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°
    # ‡πÉ‡∏ä‡πâ dropna=False ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏ß‡∏° NaN ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏î‡πâ‡∏ß‡∏¢
    grouped = df.groupby(["CustomerCode_str", "CustomerName"], sort=False, dropna=False) #‡∏à‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏ÅCustomerCode ‡πÅ‡∏•‡∏∞name
    for (code, name), group in grouped: #‡∏ß‡∏ô‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞customercode
        # ‡∏õ‡∏£‡∏±‡∏ö code ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏ CustomerCode' ‡∏ñ‡πâ‡∏≤ code ‡πÄ‡∏õ‡πá‡∏ô '0'
        display_code = code if code != '0' else "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏ CustomerCode"
        tracking_rows.append({
            "CustomerCode": display_code,
            "CustomerName": name,
            "ProjectID": f"Total Projects: {len(group)}",
            "Winner Value": "",
            "Contract Number": "",
            "SignDate": "",
            "Contract End Date": "",
            "BiddingDate": "",
            "Location": ""
        })
        # ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ô customer code
        for index, row in group.iterrows():
            # ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô row data ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô dictionary ‡πÅ‡∏ó‡∏ô list
            tracking_rows.append({
                "CustomerCode": "",
                "CustomerName": "",
                "ProjectID": row.get("ProjectID", ""), # ‡πÉ‡∏ä‡πâ .get() ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô error ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå
                "Winner Value": row.get("Winner Value", ""),
                "Contract Number": row.get("Contract Number", ""),
                "SignDate": row.get("SignDate", ""),
                "Contract End Date": row.get("Contract End Date", ""),
                "BiddingDate": row.get("BiddingDate", ""),
                "Location" : row.get("Location", "")
            })
    # ‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á DataFrame
    return pd.DataFrame(tracking_rows, columns=["CustomerCode", "CustomerName", "ProjectID", "Winner Value", "Contract Number", "SignDate", "Contract End Date","BiddingDate","Location"])

# ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡∏∏‡∏õ ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏£‡∏ö ‡∏ó‡∏±‡πâ‡∏á‡∏°‡∏µ-‡πÑ‡∏°‡πà‡∏°‡∏µ Winner ‡∏Ç‡∏≠‡∏ásummary (Revised to be cleaner and handle '0' code)
def create_grouped_tracking(df, customer_type):
    tracking_list = []
    # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏°‡∏µ CustomerCode_str
    if "CustomerCode_str" not in df.columns:
         df["CustomerCode_str"] = df["CustomerCode"].fillna(0).astype(int).astype(str)

    # ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏≤‡∏° CustomerCode_str ‡πÅ‡∏•‡∏∞ CustomerName
    grouped = df.groupby(["CustomerCode_str", "CustomerName"], dropna=False, sort=False) # ‡πÉ‡∏ä‡πâ dropna=False ‡πÅ‡∏•‡∏∞ sort=False

    for (code, name), group in grouped:
        # ‡∏Å‡∏£‡∏≠‡∏á row ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô "Winner Value" ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠ NaN
        group_with_winner = group[group.get("Winner Value", pd.NA).notna() & (group.get("Winner Value", "") != "")]
        has_winner_projects = len(group_with_winner) > 0

        # ‡∏Å‡∏≥‡∏´‡∏ô‡∏î code ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á ‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ô‡∏±‡∏ö
        display_code = code if code != '0' else "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏ CustomerCode"
        display_count = len(group_with_winner) if has_winner_projects else len(group) # ‡∏ô‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ Winner ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ, otherwise ‡∏ô‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

        # ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ñ‡∏ß‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏•‡∏∏‡πà‡∏°
        tracking_list.append({
            "CustomerCode": display_code,
            "CustomerName": name,
            "ProjectID": f"Total Projects: {display_count}",
            "Winner Value": "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ Winner Name" if not has_winner_projects else "",
            "Contract Number": "",  # ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Contract Number
            "SignDate": "" ,# ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö SignDate
            "Contract End Date": "" ,# ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Contract End Date
            "BiddingDate": "" ,#‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö BiddingDate
            "Location": "" #‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Location
        })

        # ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞ row ‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏™‡∏î‡∏á (‡∏°‡∏µ winner ‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ winner)
        rows_to_iterate = group_with_winner if has_winner_projects else group
        for index, row in rows_to_iterate.iterrows():
             # ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô row data ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô dictionary ‡πÅ‡∏ó‡∏ô list
            tracking_list.append({
                "CustomerCode": "", # CustomerCode
                "CustomerName": "", # CustomerName
                "ProjectID": row.get("ProjectID", ""),
                "Winner Value": row.get("Winner Value", ""),
                "Contract Number": row.get("Contract Number", ""),
                "SignDate": row.get("SignDate", ""),
                "Contract End Date": row.get("Contract End Date", ""),
                "BiddingDate": row.get("BiddingDate", ""),
                "Location": row.get("Location", "")
             })
    # ‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á DataFrame ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö create_tracking
    # ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ DataFrame ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
    return pd.DataFrame(tracking_list, columns=[
        "CustomerCode", "CustomerName", "ProjectID", "Winner Value","Contract Number", "SignDate", "Contract End Date","BiddingDate","Location" ])

# Create Customer Tracking (from all final_data)
# final_data already has CustomerCode_str
customer_tracking = create_tracking(final_data)

# Create Key Customer Tracking (from filtered final_data)
# Create key customer data by copying rows where "CustomerCode_str" is in the list
key_customers_data_for_tracking = final_data[final_data["CustomerCode_str"].isin(key_customers_list)].copy()
key_customer_tracking = create_tracking(key_customers_data_for_tracking)

#Difference data
# ‡∏î‡∏∂‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ (‡∏à‡∏≤‡∏Å existing_data)
prev_project_count = len(existing_data)
prev_customers_count = existing_data["CustomerCode"].fillna(0).astype(int).astype(str).nunique()
prev_key_customers_count = existing_data[
    existing_data["CustomerCode"].fillna(0).astype(int).astype(str).isin(key_customers_list)
]["CustomerCode"].nunique()

# ‡∏î‡∏∂‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ (‡∏à‡∏≤‡∏Å final_data)
new_project_count = len(final_data)
new_customers_count = final_data["CustomerCode"].fillna(0).astype(int).astype(str).nunique()
new_key_customers_count = final_data[
    final_data["CustomerCode"].fillna(0).astype(int).astype(str).isin(key_customers_list)
]["CustomerCode"].nunique()

# ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á
diff_project = new_project_count - prev_project_count
diff_customers = new_customers_count - prev_customers_count
diff_key_customers = new_key_customers_count - prev_key_customers_count

#--------------------------------------------------Create Excel-----------------------------------------------------------#

# ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô Excel ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏´‡∏•‡∏≤‡∏¢‡∏ä‡∏µ‡∏ó
report_file = f"Customer_Tracking_Report_{today_str}.xlsx"
with pd.ExcelWriter(report_file, engine="openpyxl") as writer:
    # ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Sheet "Summary Report"
    summary_data = pd.DataFrame({
        "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£": [
            "Total Projects (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏ì ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ)",
            "Total Key Customers Projects  (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á Nila ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏ì ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ)",
            "Total Other Customers Projects (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏ì ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ)"
        ],
        "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô": [
            f"{new_project_count} (+{diff_project})",
            f"{new_key_customers_count} (+{diff_key_customers})",
            f"{new_customers_count} (+{diff_customers})"
        ]
    })
    summary_data.to_excel(writer, sheet_name="Summary Report", startrow=0, index=False)

    # ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Key Projects Tracking (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô new_only) ‡πÉ‡∏ô Summary Report
    # ‡πÉ‡∏ä‡πâ .copy() ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô SettingWithCopyWarning
    key_projects_new = new_only[new_only["CustomerCode_str"].isin(key_customers_list)].copy()
    key_tracking_summary = create_grouped_tracking(key_projects_new, "Key Customers Projects (New)")
    startrow_kp = 5 # ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÅ‡∏ñ‡∏ß‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Key Projects Tracking ‡πÉ‡∏ô Summary Report
    key_tracking_summary.to_excel(writer, sheet_name="Summary Report", startrow=startrow_kp, index=False)

    # ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Other Projects Tracking (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô new_only) ‡πÉ‡∏ô Summary Report
    # ‡πÉ‡∏ä‡πâ .copy() ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô SettingWithCopyWarning
    other_projects_new = new_only[~new_only["CustomerCode_str"].isin(key_customers_list)].copy()
    other_tracking_summary = create_grouped_tracking(other_projects_new, "Other Customers Projects (New)")
    startrow_op = startrow_kp + len(key_tracking_summary) + 3 # ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÅ‡∏ñ‡∏ß‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Other Projects Tracking
    other_tracking_summary.to_excel(writer, sheet_name="Summary Report", startrow=startrow_op, index=False)
    # ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Sheet "All Data"
    final_data.to_excel(writer, sheet_name="All Data", index=False)

    # ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Sheet "Customer Tracking"
    customer_tracking.to_excel(writer, sheet_name="Customer Tracking", index=False)

    # ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Sheet "Key Customers Tracking"
    key_customer_tracking.to_excel(writer, sheet_name="Key Customers Tracking", index=False)

files.download(report_file)

print("üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:")
print(f"‚ûï Total Projects : {new_project_count} ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (+{diff_project})")
print(f"üéØ Total Key Customers Projects : {new_key_customers_count} ‡∏£‡∏≤‡∏¢ (+{diff_key_customers})")
print(f"üìã Total Other Customers Projects : {new_customers_count} ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó (+{diff_customers})")
print(f"\n ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö ‚úÖ")
print(f"\n Have a nice day‚ú®")
